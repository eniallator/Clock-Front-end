"use strict";(()=>{var l=(e,t=document)=>t.querySelector(e),i=(e,t=document)=>t.querySelectorAll(e).entries(),L=(e,t)=>e.closest(t),b=e=>{let t=document.createElement("template");return t.innerHTML=e,t.content.children.item(0)};i('[tabindex="0"]').forEach(([e,t])=>{t.onkeyup=n=>{n.key==="Enter"&&n.target===t&&t.click()}});var p=(e,t,n=!t)=>{t?(e.setAttribute("disabled",""),e.classList.add("button-disabled"),e.classList.remove("button-primary")):n&&(e.removeAttribute("disabled"),e.classList.remove("button-disabled"),e.classList.add("button-primary"))},f=l("button[type=submit]"),y=/^((0?[1-9]|1[0-2]):[0-5]\d(am|pm)|([01]\d|2[0-3]):[0-5]\d)$/i,T=/^[\da-f]{6}$/i,A=e=>l(".error-message",L(e,".form-control")),H=(e,t)=>{A(e).classList.toggle("hidden",t);let n=f.classList.contains("button-disabled");p(f,!t&&!n,i(".error-message").toArray().length===i(".error-message.hidden").toArray().length)},M=e=>{e.onchange=()=>{let t=y.test(e.value);H(e,t)}};i(".time-input").forEach(([e,t])=>{M(t)});var d=l(".time-mode"),R=(e,t)=>(e%t+t)%t,_=(e,t)=>`${R(e-1,12)+1}:${t}${e<12?"am":"pm"}`,x=(e,t,n)=>`${e%12+ +(n==="pm")*12}:`.padStart(3,"0")+t,v=/(1[0-2]|[1-9]):([0-5]\d)(am|pm)/i,g=/(2[0-3]|[01]\d):([0-5]\d)/i;d.onchange=()=>{i(".time-input").forEach(([e,t])=>{if(d.checked){let[n,o,r]=g.exec(t.value)??[];o!=null&&r!=null&&(t.value=_(Number(o),r))}else{let[n,o,r,s]=v.exec(t.value)??[];o!=null&&r!=null&&s!=null&&(t.value=x(Number(o),r,s))}})};var I=l("input[name=time]");I.value=new Date().toLocaleString().replace(/\d+\/\d+\/\d+[^\d]*(?<t>\d+:\d+).*/,"$<t>");var c=l(".color-input input[type=text]"),m=l(".color-input input[type=color]");m.onchange=()=>{c.value=m.value.slice(1).toUpperCase()};c.onchange=()=>{let e=T.test(c.value);H(c,e),e&&(m.value=`#${c.value}`)};var u=l(".collection-rows"),k=Number(u.getAttribute("collection-limit")),a=l(".collection-new-row"),N=l(".collection-template").innerHTML,S=()=>{let e=b(N);u.appendChild(e);let t=e.querySelector(".time-input");return t&&M(t),l(".delete-row",e).onclick=n=>{n.preventDefault(),e.remove(),a.classList.contains("button-disabled")&&p(a,!1)},u.children.length>=k&&p(a,!0),e},w=l("form"),$=e=>{u.innerHTML="",e.forEach(([t,n])=>{switch(t){case"time":{let[o,r,s]=g.exec(n)??[];r!=null&&s!=null&&(I.value=`${r}:${s}`);break}case"brightness":{let o=Number(n);o>=0&&o<=1&&(l("input[name=brightness]").value=n);break}case"color":{let o=n.slice(1).toUpperCase();T.test(o)&&(c.value=o,m.value=`#${o}`);break}case"alarm":{let[o,r,s]=g.exec(n)??[];r!=null&&s!=null&&(S().value=`${r}:${s}`);break}}})},B=()=>{let e=new Set(i(".time-input").map(([n,o])=>o.name));return new FormData(w).entries().filter(n=>!(n[1]instanceof File)).map(([n,o])=>{if(e.has(n)&&d.checked){let[r,s,E,h]=v.exec(o)??[];if(s!=null&&E!=null&&h!=null)return[n,x(Number(s),E,h)];throw new Error("Error deserialising")}else return[n,o]})};w.onsubmit=e=>{e.preventDefault(),e.stopPropagation();let t=new URLSearchParams([...B()]),{protocol:n,host:o,pathname:r}=location,s=`${n}//${o}${r}?${t.toString()}`;fetch(s,{method:"GET"}),history.pushState(null,"",s)};var D=/\?.+/;setInterval(()=>{fetch(`${location.protocol}//${location.host}`,{method:"GET"}).then(({url:e})=>{let[t,n]=D.exec(e)??[];n!=null&&$(new URLSearchParams(n).entries())})},5e3);a.onclick=S;var F=new URLSearchParams(location.search);$(F.entries());})();
//# sourceMappingURL=bundle.js.map
